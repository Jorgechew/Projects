// Define an async function named main
async function main() {
    console.log("Fetch initiated!");

    // Define the URL for the trivia questions API
    const url = "https://opentdb.com/api.php?amount=10&category=31&difficulty=medium&type=multiple";

    try {
        // Fetch data from the API using the defined URL
        const response = await fetch(url);

        // Log the response details to the console
        console.log(response);

        // Log whether the response is OK and its status
        console.log(`response ok? ${response.ok}`);
        console.log(`response status? ${response.status}`);

        // Check if the response is not OK, and throw an error if not
        if (!response.ok) {
            throw new Error(`something went wrong with ${response.status}.`);
        }

        // Parse the JSON data from the response
        const json = await response.json();
        const { response_code, results } = json;

        // Handle different response codes
        if (response_code === 1) {
            throw new Error('Bad API request - no results! ');
        } else if (response_code === 2) {
            throw new Error('BAD API request - invalid parameter!');
        }

        // Log the parsed JSON data
        console.log(json);

        // Get the "main" element from the document
        const main = document.querySelector("main");

        // Initialize the index for the current question
        let currentQuestionIndex = 0;

        // Define a function to display a question
        function displayQuestion() {
            // Get the current trivia item
            const triviaItem = results[currentQuestionIndex];
            const { question, difficulty, correct_answer, incorrect_answers } = triviaItem;

            // Shuffle the answer options randomly
            const allOptions = [correct_answer, ...incorrect_answers];
            allOptions.sort(() => Math.random() - 0.5);

            // Create a container for the question form
            const questionContainer = document.createElement("div");
            questionContainer.classList.add("question-container");

            // Create a form with buttons for each option
            const form = document.createElement("form");
            form.innerHTML = `
                <p>Question number: ${currentQuestionIndex + 1}</p>
                <p>Difficulty: ${difficulty}</p>
                <p>Question: ${question}</p>
                ${allOptions.map((option) => `
                    <label>
                        <input type="radio" name="userAnswer" value="${option}" />
                        <span class="custom-radio"></span>
                        ${option}
                    </label>
                    <br />
                `).join("")}
                <button type="submit">Submit Answer</button>
                <p>Correct Answer: ${correct_answer}</p>
            `;

            // Handle form submission
            form.addEventListener("submit", (event) => {
                event.preventDefault();
                const userAnswer = form.querySelector("input[name='userAnswer']:checked");
                if (userAnswer) {
                    // Compare user's answer with the correct_answer
                    const selectedOption = userAnswer.value;
                    if (selectedOption === correct_answer) {
                        userAnswer.parentElement.classList.add("correct");
                        // Move to the next question or display completion message
                        currentQuestionIndex++;
                        if (currentQuestionIndex < results.length) {
                            main.innerHTML = "";
                            displayQuestion();
                        } else {
                            main.innerHTML = "<p>All questions completed!</p>";
                        }
                    } else {
                        userAnswer.parentElement.classList.add("wrong");
                    }
                } 
            });

            // Append form to the question container and then to the main element
            questionContainer.appendChild(form);
            main.appendChild(questionContainer);
        }

        // Call the displayQuestion function to start showing questions
        displayQuestion();

    } catch (err) {
        // Handle errors by logging messages to the console
        console.log("An error occurred.");
        console.error(err);
    }
}

// Call the main function to start the trivia game
    
    main();